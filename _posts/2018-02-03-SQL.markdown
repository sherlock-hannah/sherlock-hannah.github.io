---
layout: post
title:  "SQL"
date:   2018-02-03 18:43:31 +0800
categories: jekyll update
---
## Tips
- structure query language, GUI Tools:Navicat
- RDBMS: Relational Database Management System.ER:entity relationship
- Windows power shell:
 `mysql -uroot -p`
 `show databases;`
- create sql user:
 `grant all on databases_name.* to "username"@"localhost" identified by "password"`
- show the structure of tables:`desc tablename;`
- how to execute outside sql files
 `source d:/mmzm.sql`
- `'string' as column_name`can use this string instead column

## PRIMARY KEY
Primary keys must contain UNIQUE values, and cannot contain NULL values.

A table can have only one primary key, which may consist of single or multiple fields

-  if a column set primary key,there are not duplicated value `Alter table tableNAME drop primary key`
- To create a PRIMARY KEY constraint on the "ID" column `ALTER TABLE Persons
ADD PRIMARY KEY (ID);`

## DDL(data defination language)
- CREATE DATABASE `CREATE DATABASE <DATABASE Name>`
- DELETE DATABASE `DROP DATABASE databasename;
`
- DELETE TABLE `DROP TABLE <tableNAME>;`

- Update TABLE
`ALTER  <Tablename> ADD (<column name1>,<name2>,.....);`
`UPDATE table_name SET column1 = value1, column2 = value2, ...
WHERE condition;`
- how to change column data_type
`ALTER table TABLEname
CHANGE column_name column_name datatype`
- DROP COLUMN
`ALTER TABLE table_name
DROP COLUMN column_name;`


- create TABLE
 `create table tablename(columnname1 type primary key,columnname2 type,columnname3 type ) ;`
 ```
 Create table test(PassengerId      int(64) primary key,
Pclass           int(64),
Name            varchar,
Sex             varchar,
Age            float,
SibSp            int,
Parch            int,
Ticket          int,
Fare           float,
Cabin           varchar,
Embarked        varchar);
```


## DML(data Manipulation language)
- SELECT(define which columns to return)
`SELECT <Column name>,..,...
FROM <TABLEname>;`
query all columns: use `*` to replace ` <column name>`
- using alias to creat a new column
`select column_name1,column_name2 as alias from table_name`
- removing duplicates
`SELECT distinct `

- WHERE(searsh condition,filters rows using a predicate)
`WHERE search condition'`
`WHERE like "k%"`
 to match any string of zero or more characters, use %
 to match characters that are not R, use [^R]
 to match a numeral, use [0-9]

- GROUP BY (group by list,arrange rows by group)
`GROUP BY listname`


- HAVING(search condition,filters group using a predicate)
 filter the groups
`HAVING search condition`

- ORDER BY
`ORDER BY listname asc`
upward `asc`
downward `desc`
`offset x rows fetch next y rows only`

- limit
`limit m,n`  m stands for starting from m-1 rows,n means n rows
sort before limit

- INSERT
`insert into table_name (column_name) value()`
- UPDATE statement is used to modify the existing records in a table
 `update table_name set column_name="value" where condition`
- DELETE `DELETE FROM table_name WHERE condition;`
delete all data in table ,but save the table Structures `TRUNCATE TABLE table1`
- rename `RENAME TABLE newname to oldname;`

## DCL(data Control language)
COMMIT ROLLBACK GRANT REVOKE

## Data type
data type(https://www.w3schools.com/sql/sql_datatypes.asp)
- null
- int
 Adding the `UNSIGNED` attribute will move that range up so it starts at zero instead of a negative number.
int_    Default integer type (same as C long; normally either int64 or int32)
intc    Identical to C int (normally int32 or int64)
intp    Integer used for indexing (same as C ssize_t; normally either int32 or int64)
int8    Byte (-128 to 127)
int16   Integer (-32768 to 32767)
int32   Integer (-2147483648 to 2147483647)
int64   Integer (-9223372036854775808 to 9223372036854775807)
uint8   Unsigned integer (0 to 255)
uint16  Unsigned integer (0 to 65535)
uint32  Unsigned integer (0 to 4294967295)
uint64  Unsigned integer (0 to 18446744073709551615)
- float
float_  Shorthand for `float(64,d)`.
float16 Half precision float: sign bit, 5 bits exponent, 10 bits mantissa
float32 Single precision float: sign bit, 8 bits exponent, 23 bits mantissa
float64 Double precision float: sign bit, 11 bits exponent, 52 bits mantissa
- decimal(M,N)
 scale numbers`M` precision numbers`N`
- date

## Text datatype
character type(repository of saving Text) :gbk (21000chinese character 2byte) , big5 ,gb2312 (6700 chinese character),utf8,unicode (alllanguage)
- binary System(voice,image etc binary data)
binary ,varbinary ,blob
- non binary System
char, varchar, text
- `show character set;`
- show collation rule `show collation`
`collate utf8_bin`
`collate ut8_general_ci`

## Functions
### Aggregate functions
`count(),sum(),avg(),max(),min()`

```
upper(),lower() #use in letter
concat(string1,)

ROUND(, 0)
```

- calculate functions
`mod()`
`abs()` absolute value
`round(numbers,ndigits)`



- `SELECT length(column_name) from table_name`Returns the length of the specified string (in bytes)
- `CAST`Converts a value from one datatype to another datatype
`CAST(column_name AS varchar)`
- `CONVERT(data_type(length), expression, style)`Convert an expression from one datatype to another, or one character set to another

-`STR(number, length, decimal_places)` return a string representation of a number
- `CONCAT(string1, string2, ...., string_n)`Concatenate string together
[Additional reading](https://www.w3schools.com/sql/sql_ref_mysql.asp)
-`SELECT COALESCE(NULL, NULL, NULL, 'W3Schools.com', 'Example.com');`
return the first non-null expression in a list

### Scala function
- Date Functions
[MySQl time function conclusion](http://www.cnblogs.com/she27/articles/1377089.html)

`datediff(date1,date2)` Return the difference in days between two date values:
`timediff(time1,time2)`the subtraction of two date

`year(),day(),datename(mm,column_name),datename(dw,column_name)`



### window function(online analytical processing)
- `rank()`

`danse rank()`

Returns the rank of rows within the partition of a result set, without any gaps in the ranking.

`row_number()`

```
select column_name,column_name1,
    rank() over (pattern by columnname1 order by
                    column_name2) as columnname3

from tableNAME

```                    
pattern by set the object scale of ranking

(just use in select sentence)

- Aggregate functions as window function
```
sum(columnname1) over (order by column_name2)
as columnname3
```
changing average

```
avg(columnname) over (order by columnname1 row 2 pre)
```

## Case
```
CASE WHEN <expression> THEN
     WHEN <expression> THEN
     ELSE<>
END
```



## Null
The result of any expression containing a NULL value is NULL
`2 + NULL = NULL`
- null functions: `IFNULL()`function lets you return an alternative value if an expression is NULL:


## Operators
- `=`
` < >`
 is exclusive of the range of value specified

- in a specified value matches any value in a subquery or a list
- AND
`SELECT column1, column2, ...
FROM table_name
WHERE condition1 AND condition2 AND condition3 ...;`
- OR
`SELECT column1, column2, ...
FROM table_name
WHERE condition1 OR condition2 OR condition3 ...;`
- NOT
`SELECT column1, column2, ...
FROM table_name
WHERE NOT condition;`

## The predicates

- like
`WHERE column_name like  '%ddd%'`
`WHERE column_name like 'ddd_' `
- between
`SELECT column_name(s)
FROM table_name
WHERE column_name BETWEEN value1 AND value2;`

is inclusive of the range of the value specified


- is NULL(extract some value is null)
`WHERE column_name is NULL`

- is not NULL(extract some value is not null)
`WHERE column_name is not NULL`

- in (simple use of or )
`WHERE column_name (not) in (2,3,5) `

- EXISTS



## Joins
combine rows from multiple tables by specifying matching criteria,usually
based on primary key -foreign key relationship

- inner joins
`SELECT column_name(s)
FROM table1
INNER JOIN table2 ON table1.column_name = table2.column_name;`
Inner joins return only rows where a match can be found in both tables.

- outer JOINS(designated with left,right,full keyword)
Use a Left Outer Join to include all rows from the first table and values from matched rows in the second table. Columns in the second table for which no matching rows exist are populated with NULLs.
`SELECT column_name(s)
FROM table1
LEFT JOIN table2 ON table1.column_name = table2.column_name;`
full
`SELECT column_name(s)
FROM table1
FULL OUTER JOIN table2 ON table1.column_name = table2.column_name;`

- cross JOINS
combine each row from first table with each row from second table
`select column_name1,column_name2
FROM table1 as t1
CROSS JOIN table2 as t2 `

- self JOINS
`SELECT column_name(s)
FROM table1 T1, table1 T2
WHERE condition;`

## Union
- UNION(returns a result set of distinct rows)
`SELECT column_name(s) FROM table1
UNION
SELECT column_name(s) FROM table2;`
UNION ALL retains duplicates during query processing
- intersect(returns only distinct rows that appear in both result set )


- except  (returns only distinct rows that appear in the first set but not the second)

## Loading data
```
load data local infile "C:/ProgramData/MySQL/MySQL Server 5.1/Data/Kaggle/test.csv"
into table test
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES
(PassengerId,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked;)
SET expired_date = STR_TO_DATE(@expired_date, '%m/%d/%Y');

```



## Problems
- 1.when insert chinese character into table
`ERROR 1366 (HY000): Incorrect string value: '\xD4\xF8\xBB\xAA' for column 'sname' at row 1`
- 2.How to change the length of character
solution:`ALTER table table_name column_name varchar(30)`
- 3.Notice `''` when you retrieve a value in string
- 4.Which SQL statement is used to delete data from a database?
- 5.With SQL, how do you select all the records from a table named "Persons" where the "LastName" is alphabetically between (and including) "Hansen" and "Pettersen"?
- 6.How can you change "Hansen" into "Nilsen" in the "LastName" column in the Persons table?
- 7. With SQL, how can you return the number of records in the "Persons" table?
- 8.Which operator is used to select values within a range
- 9.how to improve the speed of query
solution:[add index](https://blog.csdn.net/qq_33556185/article/details/52192551)
