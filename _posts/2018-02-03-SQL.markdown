---
layout: post
title:  "SQL"
date:   2018-02-03 18:43:31 +0800
categories: jekyll update
---
## Tips
- structure query language, GUI Tools:Navicat
- RDBMS: Relational Database Management System.ER:entity relationship
- Windows power shell:
 `mysql -uroot -p`
 `show databases;`
- create sql user:
 `grant all on databases_name.* to "username"@"localhost" identified by "password"`
- show the structure of tables:`desc tablename;`
- how to execute outside sql files
 `source d:/mmzm.sql`
- `'string' as column_name`can use this string instead column
### DDL(data defination language)
- CREATE DATABASE`CREATE DATABASE <DATABASE Name>`
- DELETE table `DROP TABLE <tableNAME>;`
- Update table
`ALTER  <Tablename> ADD (<column name1>,<name2>,.....);`
`UPDATE table_name SET column1 = value1, column2 = value2, ...
WHERE condition;`
- create table
 `create table tablename(columnname1 type primary key,columnname2 type,columnname3 type ) ;`
 ```
 Create table test(PassengerId      int(64) primary key,
Pclass           int(64),
Name            varchar,
Sex             varchar,
Age            float,
SibSp            int,
Parch            int,
Ticket          int,
Fare           float,
Cabin           varchar,
Embarked        varchar);
```


### DML(data Manipulation language)
- SELECT(define which columns to return)
`SELECT <Column name>,..,...
FROM <TABLEname>;`
query all columns: use `*` to replace ` <column name>`
- using alias to creat a new column
`select column_name1,column_name2 as alias from table_name`
- removing duplicates
`SELECT distinct `
- WHERE(searsh condition,filters rows using a predicate)
`WHERE search condition'`
`WHERE like "k%"`
 to match any string of zero or more characters, use %
 to match characters that are not R, use [^R]
 to match a numeral, use [0-9]
- GROUP BY (group by list,arrange rows by group)
`GROUP BY listname`
- HAVING(search condition,filters group using a predicate)
`HAVING search condition`
- ORDER BY
`ORDER BY listname asc`
upward `asc`
downward `desc`
`offset x rows fetch next y rows only`

- limit
`limit m,n`  m stands for starting from m-1 rows,n means n rows
sort before limit

- INSERT
`insert into table_name (column_name) value()`
- UPDATE statement is used to modify the existing records in a table
 `update table_name set column_name="value" where condition`
- DELETE `DELETE FROM table_name WHERE condition;`
- rename `RENAME TABLE newname to oldname;`

### DCL(data Control language)
COMMIT ROLLBACK GRANT REVOKE

### data type
data type(https://www.w3schools.com/sql/sql_datatypes.asp)
- null
- int
 Adding the `UNSIGNED` attribute will move that range up so it starts at zero instead of a negative number.
int_    Default integer type (same as C long; normally either int64 or int32)
intc    Identical to C int (normally int32 or int64)
intp    Integer used for indexing (same as C ssize_t; normally either int32 or int64)
int8    Byte (-128 to 127)
int16   Integer (-32768 to 32767)
int32   Integer (-2147483648 to 2147483647)
int64   Integer (-9223372036854775808 to 9223372036854775807)
uint8   Unsigned integer (0 to 255)
uint16  Unsigned integer (0 to 65535)
uint32  Unsigned integer (0 to 4294967295)
uint64  Unsigned integer (0 to 18446744073709551615)
- float
float_  Shorthand for float64.
float16 Half precision float: sign bit, 5 bits exponent, 10 bits mantissa
float32 Single precision float: sign bit, 8 bits exponent, 23 bits mantissa
float64 Double precision float: sign bit, 11 bits exponent, 52 bits mantissa
- decimal(M,N)
 scale numbers`M` precision numbers`N`
- date

### Text datatype
character type(repository of saving Text) :gbk (21000chinese character 2byte) , big5 ,gb2312 (6700 chinese character),utf8,unicode (alllanguage)
- binary System(voice,image etc binary data)
binary ,varbinary ,blob
- non binary System
char, varchar, text
- `show character set;`
- show collation rule `show collation`
`collate utf8_bin`
`collate ut8_general_ci`

### functions
`count()
sum()
avg()
max()
min()`

- `SELECT length(column_name) from table_name`Returns the length of the specified string (in bytes)
- `CAST`Converts a value from one datatype to another datatype
`CAST(column_name AS varchar)`
- `CONVERT(data_type(length), expression, style)`Convert an expression from one datatype to another, or one character set to another
-`STR(number, length, decimal_places)` return a string representation of a number
- `CONCAT(string1, string2, ...., string_n)`Concatenate string together
[Additional reading](https://www.w3schools.com/sql/sql_ref_mysql.asp)
-`SELECT COALESCE(NULL, NULL, NULL, 'W3Schools.com', 'Example.com');`
return the first non-null expression in a list

### null
The result of any expression containing a NULL value is NULL
`2 + NULL = NULL`
- null functions: `IFNULL()`function lets you return an alternative value if an expression is NULL:


### The predicates and NOT Operators
- = < >
- in a specified value matches any value in a subquery or a list
- like
- between  
- AND
`SELECT column1, column2, ...
FROM table_name
WHERE condition1 AND condition2 AND condition3 ...;`
- OR
`SELECT column1, column2, ...
FROM table_name
WHERE condition1 OR condition2 OR condition3 ...;`
- NOT
`SELECT column1, column2, ...
FROM table_name
WHERE NOT condition;`

## JOINS
combine rows from multiple tables by specifying matching criteria,usually
based on primary key -foreign key relationship

- inner joins
`SELECT column_name(s)
FROM table1
INNER JOIN table2 ON table1.column_name = table2.column_name;`
Inner joins return only rows where a match can be found in both tables.

- outer JOINS(designated with left,right,full keyword)
Use a Left Outer Join to include all rows from the first table and values from matched rows in the second table. Columns in the second table for which no matching rows exist are populated with NULLs.
`SELECT column_name(s)
FROM table1
LEFT JOIN table2 ON table1.column_name = table2.column_name;`
full
`SELECT column_name(s)
FROM table1
FULL OUTER JOIN table2 ON table1.column_name = table2.column_name;`

- cross JOINS
combine each row from first table with each row from second table
`select column_name1,column_name2
FROM table1 as t1
CROSS JOIN table2 as t2 `

- self JOINS
`SELECT column_name(s)
FROM table1 T1, table1 T2
WHERE condition;`

## union
- UNION(returns a result set of distinct rows)
`SELECT column_name(s) FROM table1
UNION
SELECT column_name(s) FROM table2;`
UNION ALL retains duplicates during query processing
- intersect(returns only distinct rows that appear in both result set )


- except  (returns only distinct rows that appear in the first set but not the second)

## loading data
```
load data local infile "C:/ProgramData/MySQL/MySQL Server 5.1/Data/Kaggle/test.csv"
into table test
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES
(PassengerId,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked;)
```

## problems
- 1.when insert chinese character into table
`ERROR 1366 (HY000): Incorrect string value: '\xD4\xF8\xBB\xAA' for column 'sname' at row 1`
- 2.How to change the length of character
solution:`ALTER table table_name column_name varchar(30)`
- 3.Notice `''` when you retrieve a value in string
